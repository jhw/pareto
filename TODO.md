### short

- consider dynamic apigw stage names

### medium 

- separate size limit for main template vs s3 nested templates
  - https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cloudformation-limits.html

- improve layer filtering in pareto/scripts/deploy_stack.py ?

- logging script to aggregate messages from all streams
- test for moto- mocked class followed by non- mocked boto3 call
- component parameters to be defined dynamically based on refs lookup

- isolate env circular reference issues
  - does s3 event source require a name ?

- github to preserve chmod 755 status
- cognito to have admin login option
- test replacing NO_SRP_XXX with newer option
- sqs:sendMessage permission to target dead letter queue
  - check lookback permissions don't require send message
- sqs, lookback permissions to target parent
- deploy_stack.py to allow deployment other than latest
- apigw extended logging
- scripts to dump and manage iam roles

- cloudfront+route53
- pinpoint
- cloudwatch alert components
- burningmonk alerts review

### v1.1

- apigw2
- sqs fifo
- eventbridge
- ec2/vpc/subnet
- appsync
- ci pipeline
- github actions
- fargate
- topology charts

### thoughts

- iam deployment user ?
  - just don't see the point given the range of stuff i need/want to do
- preprocessor to expand single layer into multiple layers and bind to actions ?
  - over-  optimisation
- script to dump outputs for UI
  - just don't think it's worth it; you can easily grab existing output
- direct inline refs (`${AppName}` not `${app_name}`) ?
  - no; is less transparent; and would likely be more troublesome to implement ref checking
- single layer ?
  - think at this point it's better to have optionality of multiple
- remove validate_bucket ?
  - no; layer and lambda push still rely on it
- pip inclusion of non- python files ?
  - not an issue for now  
- force permissions to be required so u don't forget ?
  - think this is overkill
- scaffold generator ?
  - not convinced
- lambda version -> redeploy without s3 key change ?
  - absolutely no evidence this would work
  - and also u wouldn't want to give up existing lambda names anyway
- HTTP POST x-form-www-urlencoded handler
  - too complex as doesn't seem to fit inside the lambda proxy / model integration
  - just use JSON instead
- script to login user ?
  - not really required here 
- test() script to ping all apis and buckets ?
  - no because u have this already for api access
- allow params validation for GET only ?
  - no is useful for POST too probably
- option for internal or external arn refs ?
  - not sure is worth it
- pop_dashboards() ?
  - over optimisation
- could CF.validate_template() be useful ?
  - no; just checks syntax
- refactor api resource vs endpoint nomenclature ?
  - no point
- convert capitalized variables to lower case ?
  - over- optimisation :/
- test pushing nested yaml templates to s3 ?
  - simply not worth it, JSON easier
- move nested stack param munging into stack component ?
  - no because it involves resolving template key to stack name so belongs in env
- replace api gateway stage name (currently == stage name) with action name ?
  - possibly seems logical but then this doesn't seem to be the recommended API gateway pattern
- remove template naming facility ?
  - no because dashes need names
- dsl json schema ?
  - probably not worth it
- all triggers to have option of using parameter- based action arns ?
  - not if string based arns work fine 
- support for layer arns ?
  - not worth it; build_layer.py works fine for numpy/scipy
- simplify layer key constructors ?
- export trigger, function arns ?
  - only if you plan to tie down policy document Resource field, which is currently a wildcard
- avoid having to specify empty action ?
  - can't think of decent way around it
- see if permissions generation code can be harmonised like iam roles
  - no; quite specific
- harmonise permission resource names (LambdaPermission, ApiGwPermission) ?
  - single Permission to which u pass source ?
  - probably not worth it
- clean up codebuild project every time ?
  - no because then you probably want to clean the role also which can be successfully reused
  - is probably better to have empty_artifacts.py do a global clean
- avoid resetting codebuild project every time ?
  - problem is buildspec is part of source arg passed to create_project
- build_layer.py to implement all time.sleep(wait) calls as decorators ?
  - structure doesn't really warrant it
- singularise stack names ?
  - no is too complex as means you also have to singularise references
  - if you really want to singularise stuff, singularise the keys in the dsl
- replace role wait with waiter ?
  - doesn't seem to work
- add back separate build stage so you can push multiple packages to build ?
  - no u don't need this as can use wildcards
- convert setenv.sh tp python and move into scripts ?
  - no because you don't want it to be part of pareto
- rename globals.app as globals.name ?
  - no because conflicts with resource.name 
- resource decorator to use blank props as default
  - there's no nice easy way to add a default second arg I don't think
  - simpler to make it explicit
- deploy_stack.py to check for existence of names -stage suffix
  - is probably overkill if you have reduced use of resource_name to bare minimum and are also using random_name in many unimportant places
- don't include empty props ?
  - fails if u delete them
- aggregate IAM roles ?
  - doesn't seem worth it when unlikely to be template size constraint
- multiple sqs actions ?
  - i think leave it as single action for time being for simplicity
- don't put blank subs {} ?
  - doesn't work - needs blank
- convert underscored table attribute names to hashes ?
  - no; you don't do this for any other names so why bother with table ?
- find all tests rather than just index.py ?
  - conventions should be that all tests are in index.py
  
### done

- add apigw default 4/5xx cors resources
- update new cloudformation limits
- test deployment with multiple layers
- deploy_stack to filter lambdas, layers
- add repo support for layers
- all "" as scripts wildcard option in addition to "*"
- allow ping_api.py to pass blank parameters
- test removal of table, queue, bucket etc on synth_templates
- add back assert_actions
- override action retries
- override bucket index
- rename bucket index as root
- include setup.py non- python files config [see weeblog]
- extend s3 website cors options to HEAD|OPTIONS|GET
- consider if u really need dummy AWS account toggling
- remove boto3 global clients
- examine why dynamically importing test classes fails to pick up mocks
- new tagged version
- replace srp context stuff with resource_name helper [notes]
- app_name, stage_name lambda env variables
- replace ${region} with ${AWS::Region}
- resolve authorizer name support case
- why is authorizer name- required ?
  - https://console.aws.amazon.com/support/home#/case/?displayId=7278988241&language=en
- push from zipped file
- local template dump to be zipped
- single IAM role to be used by action, apigw, userpool etc
- add back iam wildcards validation
- script to clean log groups
- delete stack failed to clean s3 bucket
- group iam permissions according to service
- API GW v1 vs v2
  - https://theburningmonk.slack.com/archives/GPM681W2K/p1598037249026700
- test project name with hypen
- abstract apigw decorator into demo root
- python 3.8 upgrade
  - https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-available.html
  - where to specify image ?
- lambdas to be staged in tmp/lambdas
- test template redployment [dashboard error]
- test template deployment
- print layer keys, lambda keys
- add deployment variables
- rename tmp/env as tmp/templates
- move layer, lambda staging code into script
- template name should be temp name not group name ("secrets")
- dash name should use standard resource_name
- move template into components and separate dash
- add back template/dashboard name
- check globals refs
- format runtime refs
- refactor build_layer.py so not dependant on globals
- pass rendered tree to template validation to avoid re- rendering
- check for superfluous parameters
- fn::sub local reference checks
- env validation failing
- master parameter types are incorrect
- join these non- output params and add them as master stack params
- filter param requirements not fulfilled by outputs on a per- template basis
- add these params as stack params (minus outputs prefix)
- add back env validation
- iterate over dash params
- modify dash rendering to use fn::sub
- separate params, outputs classes
- stop master being updated with globals
- replace cognito ${AWS::Region}
- runtime version parameter
- rename python-runtime as runtime
- refactor timer params as per layer params
- layer parameters
- components to add the parameters they require
- remove stage slug from template push keys
- check usage of resource_name in components
- fix queue name
- dashboard name refs are messed up
- bucket source arn is messed up
- cognito url refs are messed up
- examine outputted templates
- stack region
- apigw region ref
- apigw stage name ref
- remove staging dicts
- remove init_region
- remove stage from synth_templates args
- refactor stage as parameter
- refactor app as parameter
- refactor layer staging keys are parameters
- clean up lambda staging code
- refactor lambda staging key as parameter
- refactor bucket variable as parameter
- refactor runtime variable as parameter
- extended staging variables
- dedicated layer staging variable
- turn off component globals updating and see what breaks 
- change resource_name to use AppName, StageName variables (fn::sub)
- rename non_chart_value as resource_value
- move validation to end of synth process
- strip down deploy stack
- split deploy_stack into stack generation, stack deployment
- underscore app name where u underscore lambda name
- scripts/logs
- lambda logs script fails on lambda name check
- lambda ping failing on bad import
  - https://stackoverflow.com/questions/35340921/aws-lambda-import-module-error-in-python
  - https://forums.aws.amazon.com/thread.jspa?messageID=927865
- check stack deployment
- method updates still not being registered :(
  - https://console.aws.amazon.com/support/home#/case/?displayId=7282694321&language=en
- check stack generation
- add app to lambda staging
- refactor deploy_stack.py so single lambda deployable is passed around in `staging` variable
- commits to return dict rather than tuple
- check handler function exists
- check that handler for each action exists
- check that app code exists
- check if you need underscore any more
- unpack staging when passing around
- script to init staging
- pass staging instead of config["globals"]
- test lambdas push
- lambdas are missing paths
- push_lambdas.py to push a single deployable including root name
- no longer need to set classpath dynamically
- tests now broken with new package structure
- revert sample lambdas to use demo name
- allow single global commit to be specified
- see if lambda staging code can be cleaned up
- remove services
- remove lambda permissions
- remove filter_actions
